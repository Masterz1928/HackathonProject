<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCR with Tesseract.js</title>
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5.0.0/dist/tesseract.min.js'></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">

    <!-- Main Container -->
    <div class="bg-white rounded-xl shadow-lg p-6 max-w-2xl w-full">
        <h1 class="text-3xl font-bold text-center mb-6 text-gray-800">Free OCR App</h1>
        <p class="text-center text-gray-600 mb-6">
            Extract text from any image, completely free and offline, using Tesseract.js.
        </p>
        
        <!-- File Input and Action Buttons -->
        <div class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4 mb-6">
            <input type="file" id="fileInput" accept="image/*" class="flex-grow p-2 border border-gray-300 rounded-lg cursor-pointer">
            <button id="extractButton" class="w-full md:w-auto bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                Extract Text
            </button>
            <button id="clearButton" class="w-full md:w-auto bg-red-500 text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-red-600 transition duration-300">
                Clear
            </button>
        </div>

        <!-- Image and Result Display Area -->
        <div id="status" class="text-center text-gray-500 mb-4">Select an image to begin.</div>

        <div id="preview" class="mb-6 rounded-lg overflow-hidden border border-gray-300 hidden">
            <img id="imagePreview" src="" alt="Image Preview" class="max-w-full h-auto">
        </div>

        <div id="output" class="hidden">
            <h2 class="text-xl font-semibold mb-2">Extracted Text:</h2>
            <div id="resultContainer" class="relative bg-gray-50 border border-gray-300 rounded-lg p-4">
                <textarea id="resultTextarea" class="w-full min-h-96 bg-transparent text-gray-700 outline-none resize-none" readonly></textarea>
                <button id="copyButton" class="absolute top-2 right-2 p-2 bg-gray-200 rounded-lg text-gray-600 hover:bg-gray-300 transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                        <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Custom Modal for Alerts -->
    <div id="custom-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-lg p-6 max-w-sm w-full">
            <div class="text-xl font-semibold mb-4" id="modal-title"></div>
            <p id="modal-message" class="text-gray-700 mb-6"></p>
            <div class="flex justify-end">
                <button id="modal-close-btn" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition">OK</button>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const fileInput = document.getElementById('fileInput');
            const imagePreview = document.getElementById('imagePreview');
            const previewContainer = document.getElementById('preview');
            const extractButton = document.getElementById('extractButton');
            const clearButton = document.getElementById('clearButton');
            const statusDiv = document.getElementById('status');
            const outputDiv = document.getElementById('output');
            const resultTextarea = document.getElementById('resultTextarea');
            const copyButton = document.getElementById('copyButton');
            const customModal = document.getElementById('custom-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalCloseBtn = document.getElementById('modal-close-btn');

            // Show a custom modal instead of alert()
            const showModal = (title, message) => {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                customModal.classList.remove('hidden');
            };

            modalCloseBtn.addEventListener('click', () => {
                customModal.classList.add('hidden');
            });

            // Handle file selection
            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        imagePreview.src = event.target.result;
                        previewContainer.classList.remove('hidden');
                        statusDiv.textContent = 'Image loaded. Click "Extract Text" to process.';
                        outputDiv.classList.add('hidden');
                        extractButton.disabled = false;
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Handle text extraction
            extractButton.addEventListener('click', async () => {
                const file = fileInput.files[0];
                if (!file) {
                    showModal('Error', 'Please select an image first.');
                    return;
                }

                extractButton.disabled = true;
                statusDiv.textContent = 'Processing... Please wait.';

                try {
                    const { data: { text } } = await Tesseract.recognize(
                        file,
                        'eng', // You can change the language here
                        { logger: m => console.log(m) }
                    );

                    resultTextarea.value = text;
                    outputDiv.classList.remove('hidden');
                    statusDiv.textContent = 'Extraction complete!';
                    
                } catch (error) {
                    console.error(error);
                    statusDiv.textContent = 'Error during extraction. Please try again.';
                    showModal('Error', 'An error occurred during text extraction. Please check the console for details.');
                } finally {
                    extractButton.disabled = false;
                }
            });

            // Handle clear button
            clearButton.addEventListener('click', () => {
                fileInput.value = '';
                imagePreview.src = '';
                previewContainer.classList.add('hidden');
                outputDiv.classList.add('hidden');
                statusDiv.textContent = 'Select an image to begin.';
                extractButton.disabled = true;
            });
            
            // Handle copy to clipboard
            copyButton.addEventListener('click', () => {
                resultTextarea.select();
                resultTextarea.setSelectionRange(0, 99999);
                try {
                    document.execCommand('copy');
                    showModal('Success', 'Text copied to clipboard!');
                } catch (err) {
                    showModal('Error', 'Failed to copy text. Your browser may not support this feature.');
                    console.error('Failed to copy text: ', err);
                }
            });
        });
    </script>
</body>
</html>
